{"ast":null,"code":"var _jsxFileName = \"/Users/aizhanyl/Downloads/myshopSkin/src/contexts/ProductsContext.js\",\n    _s = $RefreshSig$();\n\nimport axios from 'axios';\nimport React, { useReducer, useState } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { calcSubPrice, calcTotalPrice } from '../helpers/calcPrice';\nimport { API } from '../helpers/constants';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const productContext = /*#__PURE__*/React.createContext();\nconst INIT_STATE = {\n  products: [],\n  edit: null,\n  paginatedPages: 1,\n  cart: [],\n  cartLength: 0,\n  detail: [],\n  favorites: []\n};\n\nconst reducer = (state = INIT_STATE, action) => {\n  switch (action.type) {\n    case \"GET_PRODUCTS\":\n      return { ...state,\n        products: action.payload.data,\n        paginatedPages: Math.ceil(action.payload.headers[\"x-total-count\"] / 3)\n      };\n\n    case \"GET_EDIT_PRODUCT\":\n      return { ...state,\n        edit: action.payload\n      };\n\n    case \"CHANGE_CART_COUNT\":\n      return { ...state,\n        cartLength: action.payload\n      };\n\n    case \"GET_CART\":\n      return { ...state,\n        cart: action.payload\n      };\n\n    case \"GET_DETAIL_PRODUCT\":\n      return { ...state,\n        detail: action.payload\n      };\n\n    case \"CHANGE_FAVORITES_COUNT\":\n      return { ...state,\n        favorites: action.payload\n      };\n\n    default:\n      return state;\n  }\n};\n\nconst ProductsContext = ({\n  children\n}) => {\n  _s();\n\n  const [state, dispatch] = useReducer(reducer, INIT_STATE);\n  const [bar, setBar] = useState(false);\n  const history = useHistory();\n\n  const getProducts = async () => {\n    const search = new URLSearchParams(history.location.search);\n    search.set('_limit', 9);\n    history.push(`${history.location.pathname}?${search.toString()}`);\n    let data = await axios(`${API}/products/${window.location.search}`);\n    dispatch({\n      type: \"GET_PRODUCTS\",\n      payload: data\n    });\n  };\n\n  const addProduct = async newProduct => {\n    console.log(newProduct);\n\n    try {\n      let res = await axios.post(`${API}/products`, newProduct);\n      return res;\n    } catch (err) {\n      console.log(err);\n      return err;\n    }\n  };\n\n  const editProduct = async id => {\n    const {\n      data\n    } = await axios.get(`${API}/products/${id}`);\n    dispatch({\n      type: \"GET_EDIT_PRODUCT\",\n      payload: data\n    });\n  };\n\n  const saveEditProduct = async updateProduct => {\n    try {\n      let res = await axios.patch(`${API}/products/${updateProduct.id}`, updateProduct);\n      return res;\n    } catch (error) {\n      console.log(error);\n      return error;\n    }\n  };\n\n  const deleteProduct = async (id, history) => {\n    await axios.delete(`${API}/products/${id}`);\n    getProducts(history);\n  };\n\n  const addProductInCart = product => {\n    let cart = JSON.parse(localStorage.getItem('cart'));\n\n    if (!cart) {\n      cart = {\n        products: [],\n        totalPrice: 0\n      };\n    }\n\n    let newProduct = {\n      item: product,\n      count: 1,\n      subPrice: 0\n    };\n    let filteredCart = cart.products.filter(elem => elem.item.id === product.id);\n\n    if (filteredCart.length > 0) {\n      cart.products = cart.products.filter(elem => elem.item.id !== product.id);\n    } else {\n      cart.products.push(newProduct);\n    }\n\n    newProduct.subPrice = calcSubPrice(newProduct);\n    cart.totalPrice = calcTotalPrice(cart.products);\n    localStorage.setItem('cart', JSON.stringify(cart));\n    dispatch({\n      type: \"CHANGE_CART_COUNT\",\n      payload: cart.products.length\n    });\n  };\n\n  const getCartLength = () => {\n    let cart = JSON.parse(localStorage.getItem('cart'));\n\n    if (!cart) {\n      cart = {\n        products: [],\n        totalPrice: 0\n      };\n    }\n\n    dispatch({\n      type: \"CHANGE_CART_COUNT\",\n      payload: cart.product.length\n    });\n  };\n\n  const getCart = () => {\n    let cart = JSON.parse(localStorage.getItem('cart'));\n\n    if (!cart) {\n      cart = {\n        products: [],\n        totalPrice: 0\n      };\n    }\n\n    dispatch({\n      type: \"GET_CART\",\n      payload: cart\n    });\n  };\n\n  const buy = () => {\n    localStorage.clear();\n  };\n\n  const changeProductCount = (count, id) => {\n    let cart = JSON.parse(localStorage.getItem('cart'));\n    cart.products = cart.product.map(elem => {\n      if (elem.item.id === id) {\n        elem.count = count;\n        elem.subPrice = calcSubPrice(elem);\n      }\n\n      return elem;\n    });\n    cart.totalPrice = calcTotalPrice(cart.products);\n    localStorage.setItem('cart', JSON.stringify(cart));\n    getCart();\n  };\n\n  const checkProductInCart = id => {\n    let cart = JSON.parse(localStorage.getItem('cart'));\n\n    if (!cart) {\n      cart = {\n        products: [],\n        totalPrice: 0\n      };\n    }\n\n    let newCart = cart.products.filter(elem => elem.item.id === id);\n    return newCart.length > 0 ? true : false;\n  };\n\n  const getDetail = async id => {\n    const {\n      data\n    } = await axios.get(`${API}/products/${id}`);\n    dispatch({\n      type: \"GET_DETAIL_PRODUCT\",\n      payload: data\n    });\n  };\n\n  const openSidebar = () => {\n    setBar(true);\n  };\n\n  const addProductInFavorites = product => {\n    let favorites = JSON.parse(localStorage.getItem('favorites'));\n\n    if (!favorites) {\n      favorites = {\n        products: []\n      };\n    }\n\n    let newProduct = {\n      item: product\n    };\n    let productToFind = favorites.products.filter(item => item.item.id === product.id);\n\n    if (productToFind.length === 0) {\n      favorites.products.push(newProduct);\n    } else {\n      favorites.products = favorites.products.filter(item => item.item.id !== product.id);\n    }\n\n    localStorage.setItem('favorites', JSON.stringify(favorites));\n    dispatch({\n      type: \"CHANGE_FAVORITES_COUNT\",\n      payload: favorites\n    });\n  };\n\n  const getFavoritesLength = () => {\n    let favorites = JSON.parse(localStorage.getItem('favorites'));\n\n    if (!favorites) {\n      favorites = {\n        products: []\n      };\n    }\n\n    dispatch({\n      type: \"CHANGE_FAVORITES_COUNT\",\n      payload: favorites.product.length\n    });\n  };\n\n  const getFavorites = () => {\n    let favorites = JSON.parse(localStorage.getItem('favorites'));\n\n    if (!favorites) {\n      localStorage.setItem('favorites', JSON.stringify({\n        products: []\n      }));\n      favorites = {\n        products: []\n      };\n    }\n\n    dispatch({\n      type: \"CHANGE_FAVORITES_COUNT\",\n      payload: favorites\n    });\n  };\n\n  const checkProductinFavorites = id => {\n    let favorites = JSON.parse(localStorage.getItem('favorites'));\n\n    if (!favorites) {\n      favorites = {\n        products: []\n      };\n    }\n\n    let newFavorites = favorites.products.filter(elem => elem.item.id === id);\n    return newFavorites.length > 0 ? true : false;\n  };\n\n  return /*#__PURE__*/_jsxDEV(productContext.Provider, {\n    value: {\n      products: state.products,\n      edit: state.edit,\n      paginatedPages: state.paginatedPages,\n      cart: state.cart,\n      cartLength: state.cartLength,\n      detail: state.detail,\n      favorites: state.favorites,\n      getProducts,\n      addProduct,\n      editProduct,\n      saveEditProduct,\n      deleteProduct,\n      addProductInCart,\n      getCartLength,\n      changeProductCount,\n      checkProductInCart,\n      checkProductinFavorites,\n      getCart,\n      getDetail,\n      openSidebar,\n      setBar,\n      bar,\n      buy,\n      getFavorites,\n      addProductInFavorites,\n      getFavoritesLength\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 268,\n    columnNumber: 9\n  }, this);\n};\n\n_s(ProductsContext, \"fqSBI3yYLH8/8YnPuhBkJ/Q7wzo=\", false, function () {\n  return [useHistory];\n});\n\n_c = ProductsContext;\nexport default ProductsContext;\n\nvar _c;\n\n$RefreshReg$(_c, \"ProductsContext\");","map":{"version":3,"sources":["/Users/aizhanyl/Downloads/myshopSkin/src/contexts/ProductsContext.js"],"names":["axios","React","useReducer","useState","useHistory","calcSubPrice","calcTotalPrice","API","productContext","createContext","INIT_STATE","products","edit","paginatedPages","cart","cartLength","detail","favorites","reducer","state","action","type","payload","data","Math","ceil","headers","ProductsContext","children","dispatch","bar","setBar","history","getProducts","search","URLSearchParams","location","set","push","pathname","toString","window","addProduct","newProduct","console","log","res","post","err","editProduct","id","get","saveEditProduct","updateProduct","patch","error","deleteProduct","delete","addProductInCart","product","JSON","parse","localStorage","getItem","totalPrice","item","count","subPrice","filteredCart","filter","elem","length","setItem","stringify","getCartLength","getCart","buy","clear","changeProductCount","map","checkProductInCart","newCart","getDetail","openSidebar","addProductInFavorites","productToFind","getFavoritesLength","getFavorites","checkProductinFavorites","newFavorites"],"mappings":"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","sourcesContent":["import axios from 'axios';\nimport React, { useReducer, useState } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { calcSubPrice, calcTotalPrice } from '../helpers/calcPrice';\nimport { API } from '../helpers/constants';\n\nexport const productContext = React.createContext()\n\nconst INIT_STATE = {\n    products: [],\n    edit: null,\n    paginatedPages: 1,\n    cart: [],\n    cartLength: 0,\n    detail: [],\n    favorites:[]\n}\n\nconst reducer = (state = INIT_STATE, action) => {\n    switch (action.type) {\n        case \"GET_PRODUCTS\":\n            return {\n                ...state, products: action.payload.data,\n                paginatedPages: Math.ceil(action.payload.headers[\"x-total-count\"] / 3)\n            }\n        case \"GET_EDIT_PRODUCT\":\n            return {\n                ...state, edit: action.payload\n            }\n        case \"CHANGE_CART_COUNT\":\n            return {\n                ...state, cartLength: action.payload\n            }\n        case \"GET_CART\":\n            return {\n                ...state, cart: action.payload\n            }\n        case \"GET_DETAIL_PRODUCT\":\n            return {\n                ...state, detail: action.payload\n            }\n        case \"CHANGE_FAVORITES_COUNT\":\n            return{\n                ...state, favorites:action.payload\n            }\n        default: return state\n    }\n}\n\nconst ProductsContext = ({ children }) => {\n    const [state, dispatch] = useReducer(reducer, INIT_STATE)\n    const [bar, setBar]=useState    (false)\n    const history = useHistory()\n\n    const getProducts = async () => {\n        const search = new URLSearchParams(history.location.search)\n        search.set('_limit', 9)\n        history.push(`${history.location.pathname}?${search.toString()}`)\n        let data = await axios(`${API}/products/${window.location.search}`)\n        dispatch({\n            type: \"GET_PRODUCTS\",\n            payload: data\n        })\n    }\n\n    const addProduct = async (newProduct) => {\n        console.log(newProduct);\n        try {\n            let res = await axios.post(`${API}/products`, newProduct)\n            return res\n        } catch (err) {\n            console.log(err)\n            return err\n        }\n    }\n\n    const editProduct = async (id) => {\n        const { data } = await axios.get(`${API}/products/${id}`)\n        dispatch({\n            type: \"GET_EDIT_PRODUCT\",\n            payload: data\n        })\n    }\n\n    const saveEditProduct = async (updateProduct) => {\n        try {\n            let res = await axios.patch(`${API}/products/${updateProduct.id}`, updateProduct)\n            return res\n        } catch (error) {\n            console.log(error)\n            return error\n        }\n    }\n\n    const deleteProduct = async (id, history) => {\n        await axios.delete(`${API}/products/${id}`)\n        getProducts(history)\n    }\n\n    const addProductInCart = (product) => {\n        let cart = JSON.parse(localStorage.getItem('cart'))\n        if (!cart) {\n            cart = {\n                products: [],\n                totalPrice: 0\n            }\n        }\n        let newProduct = {\n            item: product,\n            count: 1,\n            subPrice: 0\n        }\n        let filteredCart = cart.products.filter(elem => elem.item.id === product.id)\n        if (filteredCart.length > 0) {\n            cart.products = cart.products.filter(elem => elem.item.id !== product.id)\n        } else {\n            cart.products.push(newProduct)\n        }\n        newProduct.subPrice = calcSubPrice(newProduct)\n        cart.totalPrice = calcTotalPrice(cart.products)\n        localStorage.setItem('cart', JSON.stringify(cart))\n        dispatch({\n            type: \"CHANGE_CART_COUNT\",\n            payload: cart.products.length\n        })\n    }\n\n    const getCartLength = () => {\n        let cart = JSON.parse(localStorage.getItem('cart'))\n        if (!cart) {\n            cart = {\n                products: [],\n                totalPrice: 0\n            }\n        }\n        dispatch({\n            type: \"CHANGE_CART_COUNT\",\n            payload: cart.product.length\n        })\n    }\n\n    const getCart = () => {\n        let cart = JSON.parse(localStorage.getItem('cart'))\n        if (!cart) {\n            cart = {\n                products: [],\n                totalPrice: 0\n            }\n        }\n        dispatch({\n            type: \"GET_CART\",\n            payload: cart\n        })\n    }\n\n    const buy = () => {\n        localStorage.clear()\n    }\n\n    const changeProductCount = (count, id) => {\n        let cart = JSON.parse(localStorage.getItem('cart'))\n        cart.products = cart.product.map(elem => {\n            if (elem.item.id === id) {\n                elem.count = count\n                elem.subPrice = calcSubPrice(elem)\n            }\n            return elem\n        })\n        cart.totalPrice = calcTotalPrice(cart.products)\n        localStorage.setItem('cart', JSON.stringify(cart))\n        getCart()\n    }\n\n    const checkProductInCart = (id) => {\n        let cart = JSON.parse(localStorage.getItem('cart'))\n        if (!cart) {\n            cart = {\n                products: [],\n                totalPrice: 0\n            }\n        }\n        let newCart = cart.products.filter(elem => elem.item.id === id)\n        return newCart.length > 0 ? true : false\n    }\n\n    const getDetail = async (id) => {\n        const { data } = await axios.get(`${API}/products/${id}`)\n        dispatch({\n            type: \"GET_DETAIL_PRODUCT\",\n            payload: data\n        })\n    }\n\n    const openSidebar=()=>{\n        setBar(true)\n    }\n        const addProductInFavorites = (product) => {\n            let favorites = JSON.parse(localStorage.getItem('favorites'));\n        if (!favorites) {\n            favorites = {\n            products: [],\n          };\n        }\n        let newProduct = {\n          item: product,\n        };\n    \n        let productToFind = favorites.products.filter((item) => item.item.id === product.id);\n        if (productToFind.length === 0) {\n            favorites.products.push(newProduct);\n        } else {\n            favorites.products = favorites.products.filter((item) => item.item.id !== product.id);\n        }\n        localStorage.setItem('favorites', JSON.stringify(favorites));\n        dispatch({\n          type: \"CHANGE_FAVORITES_COUNT\",\n          payload: favorites,\n        });\n        }\n\n    const getFavoritesLength = () => {\n        let favorites = JSON.parse(localStorage.getItem('favorites'))\n        if (!favorites) {\n            favorites = {\n                products: [],\n                \n            }\n        }\n        dispatch({\n            type: \"CHANGE_FAVORITES_COUNT\",\n            payload: favorites.product.length\n        })\n    }\n\n    const getFavorites = () => {\n        let favorites = JSON.parse(localStorage.getItem('favorites'));\n        if (!favorites) {\n          localStorage.setItem(\n            'favorites',\n            JSON.stringify({\n              products: [],\n            })\n          );\n          favorites = {\n            products: [],\n          };\n        }\n        dispatch({\n          type: \"CHANGE_FAVORITES_COUNT\",\n          payload: favorites,\n        });\n      };\n\n    const checkProductinFavorites = (id) => {\n        let favorites = JSON.parse(localStorage.getItem('favorites'))\n        if (!favorites) {\n            favorites = {\n                products: [],\n            \n            }\n        }\n        let newFavorites = favorites.products.filter(elem => elem.item.id === id)\n        return newFavorites.length > 0 ? true : false\n    }\n\n\n    return (\n        <productContext.Provider value={{\n            products: state.products,\n            edit: state.edit,\n            paginatedPages: state.paginatedPages,\n            cart: state.cart,\n            cartLength: state.cartLength,\n            detail: state.detail,\n            favorites:state.favorites,\n            getProducts,\n            addProduct,\n            editProduct,\n            saveEditProduct,\n            deleteProduct,\n            addProductInCart,\n            getCartLength,\n            changeProductCount,\n            checkProductInCart,\n            checkProductinFavorites,\n            getCart,\n            getDetail,\n            openSidebar,\n            setBar,\n            bar,\n            buy,\n            getFavorites, \n            addProductInFavorites, \n            getFavoritesLength\n        }}>\n            {children}\n        </productContext.Provider>\n    );\n};\nexport default ProductsContext;"]},"metadata":{},"sourceType":"module"}